<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[Indigo]&lt;Maxc>MSOURCES.DM!2>mdocument.bravo</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">// mdocument.bravo--external procedures and statics of Midas<br><br><br>//MIDAS<br><br>Nmidas</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Main program<br><br>PutField</span><span class="tab" val="63"></span><span style="font: 10pt serif">// PutField(Bit1, NBits, DVec, Field) will copy NBits<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// from Field (right adjusted word) to a position in<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// DVec, starting with Bit number Bit1, where the bits<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// are numbered starting from 0, and from high order bit<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// to low order bit.  NBits must be le 16.<br><br>GetField</span><span class="tab" val="63"></span><span style="font: 10pt serif">// GetField(Bit1, NBits, DVec) returns the contents of the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// named field.  (will be right justified).<br><br>StartTimer</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Put -time in TimeStart to begin interval timing<br><br>ElapsedTime</span><span class="tab" val="63"></span><span style="font: 10pt serif">// (Initialization only) Allocate storage for timer and<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// record elapsed time since TimeStart.<br><br>MidasFinish</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Routine invoked by bcpl finish and by Run-Program command<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// prior to RestoreState<br><br>//STATEINIT<br><br>StorageInit</span><span class="tab" val="63"></span><span style="font: 10pt serif">// StorageInit(FirstStatic,LastStatic,sysZoneSize,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">StackSize,ErrRtn)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// init storage area, rebuild sysZone after Junta,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Allocate the StateBlock for subsequent use of BeginSave<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// and SaveState.  FirstStatic and LastStatic delimit<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// the static area as given in the Layout vector passed to<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Nmidas by CallSubsys.<br><br>SaveStatics</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Called with up to 20 args.  The args are pointers to<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// page zero statics or other program locations which<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// must be saved/restored by SaveState/RestoreState.<br><br><br>//STATE<br><br>BeginSave</span><span class="tab" val="63"></span><span style="font: 10pt serif">// All storage allocated by GetStorage after BeginSave<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is preserved by SaveState and restored by RestoreState.<br><br>GetStorage  </span><span class="tab" val="63"></span><span style="font: 10pt serif">//  GetStorage(Size) returns pointer to permanent block of<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// size Size, or calls Swat if not enough space.<br><br>GetEvenStorage // GetEvenStorage(Size) returns pointer to block of size <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Size which starts on an even address<br><br>StorageLeft</span><span class="tab" val="63"></span><span style="font: 10pt serif">// returns the amount of free storage left for GetStorage.<br><br>SaveState</span><span class="tab" val="63"></span><span style="font: 10pt serif">// SaveState(S,Label) writes the program "state" on the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// stream S.  Label in the caller&rsquo;s frame is the location<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// which is resumed to by RestoreState (should be right<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// after call to SaveState).<br><br>RestoreState</span><span class="tab" val="63"></span><span style="font: 10pt serif">// RestoreState(S,reinitFlag) restores "state" from the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// stream S.  reinitFlag is true when RestoreState is<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// called as part of program initialization, false when<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// call is to reinitialize for Run-Program.<br><br><br>//MASM</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Hand-coded procedures<br><br>DummyCall</span><span class="tab" val="63"></span><span style="font: 10pt serif">// DummyCall(lv Proc,NA,A1,A2,...,An) calls Proc with NA<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//args so that the overlay machinery can intercept the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//call and return.<br><br>ErrorProtect</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ErrorProtect(lv Proced, A1, A2, ... An) will result in<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// a call on Proced with the n params, A1, ... An.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Subsequently, DisplayError causes a return from this<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// call.  If the overlay machinery was invoked, the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// overlays are killed.<br><br>Mag</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Mag(X) is the magnitude of X.<br><br>Max</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Max(X,Y) is the maximum of X and Y.<br><br>Min</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Min(X,Y) is the minimum of X and Y.<br><br>StrSize</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// StrSize(StrPtr) is the length of the string in words.<br><br>SearchBlock</span><span class="tab" val="63"></span><span style="font: 10pt serif">// SearchBlock(Block,Boffset,Bname,Addr,MemX) is a<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// subroutine which searches Block for the symbol<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// in MemX whose value is the largest less than or equal to<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Addr (see MSYM).<br><br>MoveUp</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// MoveUp(To,From,Count) moves the block of words of length<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Count with last location at From to the block whose last<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// location is at To (i.e. like MoveBlock but starting at the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// last location of the block).<br><br>VertIntCode</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Vertical interrupt routine initialized in MDISP<br><br>ClearAndScanConvert<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// ClearAndScanConvert(BitBuffer,TextVec) used by MDISP<br><br>SymbKeyComp</span><span class="tab" val="63"></span><span style="font: 10pt serif">// SymbKeyComp(Str1,Str2) compares the two strings<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// returning 0 on equal, positive on Str1 &gt;= Str2,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// negative on Str1 &lt; Str2.<br><br>BinScan</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// BinScan(Block,Key) returns the index of the greatest<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// record in Block with key le Key.<br><br>GetBodySize</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Another subroutine for MSYM.<br><br>FindBlock</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Another subroutine for MSYM.<br><br><br>//MDISP<br><br>PaintLine</span><span class="tab" val="63"></span><span style="font: 10pt serif">// PaintLine(L, TV)  scan converts textvec TV onto<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// screen line L, used only by  PaintScreen in mrgn<br><br>GetMouseAndCursor// GetMouseAndCursor() places the current values of<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//Mouse Buttons, Cursor, line index, and cursor char index<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//into NewMB, NewLx, and NewCx<br><br>FinishDisplay</span><span class="tab" val="63"></span><span style="font: 10pt serif">// FinishDisplay() should be called before returning to<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// operating system, if InitDisplay has been previously<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// called<br><br>Blink</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Blink() will blink the entire display once<br><br>SetDisplay</span><span class="tab" val="63"></span><span style="font: 10pt serif">// SetDisplay(Flag) turns off the display if Flag is true,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// turns it on if Flag is false.<br><br>MakeDispZoneAvail<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// MakeDispZoneAvail(FirstLine, NWords) blackens some<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// of screen (FirstLine to FirstLine + NLines - 1),<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// where NLines is computed to make at least NWords<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// available, and<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// returns a Zone constructed from the bit buffers<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// of that portion of the screen.  Used only by <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Moverlay.bcpl.<br><br>ReUseDispSpace</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ReUseDispSpace() reverses the effect of<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// MakeDispSpaceAvail.  Used only by ReUseScreenSpace<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// of mrgn.bcpl and by moverlay.bcpl after init.<br><br>PrepareCharInv</span><span class="tab" val="63"></span><span style="font: 10pt serif">// PrepareCharInv(charlocinfont) is called by<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// ClearAndScanConvert in MASM it invert black for<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// white<br><br><br>//MRGN<br><br>DriverLoop</span><span class="tab" val="63"></span><span style="font: 10pt serif">// DirverLoop() is called by Midas.  This is the main<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// loop of midas.  It returns only for exit from midas.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// It is also called by StartCmdOverlay in MCMD to<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// put up alternate command menus.<br><br>MarkRgnDispDirty</span><span class="tab" val="63"></span><span style="font: 10pt serif">// MarkRgnDispDirty(R) indicates that region R<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// should paint during next display loop<br><br>ModifyRgnLine</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ModifyRgnLine(rlx, rcx, TV) is used by a regions <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Paint routine to place text vec TV at relative location<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// rlx, rcx.  Modifies chars rcx to rcx + TV!0 - 1<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Regions paint routine is at R&gt;&gt;Rgn.pPaint<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// and is called by DisplayLoop<br><br>PaintRgnLine</span><span class="tab" val="63"></span><span style="font: 10pt serif">// PaintRgnLine(rlx, TV) is used like ModifyRgnLine,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// except paints the whole line within the region.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// TV is placed at rlc to rlc + TV!0 - 1, blanks follow<br><br>UpdateDisplay</span><span class="tab" val="63"></span><span style="font: 10pt serif">// UpdateDisplay() causes the screen to be recomputed.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// It is called by DriverLoop and by actions which want<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// the display updated before returing to DriverLoop.<br><br>BeginError</span><span class="tab" val="63"></span><span style="font: 10pt serif">// BeginError(Rgn) will start error processing.  The only<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// region which will be active is Rgn.  This routine<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// should only be called when mouse buttons are 0,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// else unpredictable results will occur.<br><br>EndError</span><span class="tab" val="63"></span><span style="font: 10pt serif">// EndError(P) will terminate error processing. <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// P will be returned as a result of the original call<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// on BeginError.<br><br>AddToEveryTimeList<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// AddToEveryTimeList(Proc, Arg) assuures that a call<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// will be made to "Proc(Arg)" once every time<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// around the main driver loop.  AddTO... returns<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// as result a pointer which can be used as an argument<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// to RemoveFromEveryTimeList.<br><br>RemoveFromEveryTimeList<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// RemoveFromEveryTimeList(Entry) will stop the calls<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// resulting from an earlier call on AddToEveryTimeList,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// where that earlier call returned Entry.<br><br><br>//MTV<br><br>StreamFromTextName<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// StreamFromTextName(Act, TV, DotExt, ksType, ItemSize)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// returns a stream.  First, a string name for the file<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is computed.  It is a string constructed from<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// TextVec TV, or such a string with DotExt appended<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// to it. (DotExt is a string).  DotExt will be appended<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// if no Periods appear in TV.  Finally, the stream is<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// obtained by Act(Name, ksType, ItemSize)<br><br><br>//MPARSE<br><br>ParseAddress</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ParseAddress(TV,lvX,PV,lvY)<br><br>ParseTextList</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ParseTextList(TV,lvX,Pv,lvY)<br><br><br>//MIOC<br><br>MTexttoData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// MTexttoData(MemX,TV,DVec) and<br>RTexttoData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// RTexttoData(RegX,TV,DVec) accept a memory or register<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// index, a TextVec TV (one char/word<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">TV!1, TV!2, . . . TV!(TV!0), and a DataVec<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// They convert the TextVec into a DataVec for the selected<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// register or memory<br><br>SimpleTexttoDVec<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// SimpleTexttoDVec(TV,Nbits,DVec) converts an octal<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// TextVec into a DataVec of size Nbits.  Blanks are<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// flushed.  If characters other than octal chars and<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// blanks are in TV, then the text is treated as an<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// an address and offset which is evaluated.<br><br>MDatatoStream</span><span class="tab" val="63"></span><span style="font: 10pt serif">// MDatatoStream(Stream,MemX,DVec) and<br>RDatatoStream</span><span class="tab" val="63"></span><span style="font: 10pt serif">// RDatatoStream(Stream,RegX,DVec) format data in DVec<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// and output the text to Stream under control of a<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// formatting table pointed at by MEMFORMS!MemX or by<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// REGFORMS!RegX.<br><br>SimpleDVectoStream<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// SimpleDVectoStream(Stream,NBits,DVec,flush0,LastFlag)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// converts NBits of DVec to an octal string output to<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Stream.  If flush0 eq 0 then leading zeroes in the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// output are suppressed.  If flush0 eq $0 then leading<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// zeroes are printed.  If the entire result is 0,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// then LastFlag eq true will print the final 0, else not.<br><br><br>//MOVERLAY<br><br>UserReadOverlay<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Used by LPD&rsquo;s overlay package.  Constructs OverlayZone<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// from the display bit buffers using MakeDispZoneAvail.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// This zone is used for the overlay.<br><br>KillOverlays</span><span class="tab" val="63"></span><span style="font: 10pt serif">// KillOverlays() will cause all overlays to be flushed.<br><br>SwappedOut</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Dummy routine needed by BLDR.<br><br><br>//MSYM<br><br>EvalAText</span><span class="tab" val="63"></span><span style="font: 10pt serif">// EvalAText(TV, lvX, AVal, ifExpectMore) will return<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// true if the text starting at TV!(rv lvX) has the form<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// of an address, and unless ifExpectMore, is not<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// followed by more text.  In the case of a true return,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// AVal is filled with information describing the address.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// See later for the structure of AVal.  rv lvX is<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// adjuested to point to the next field, after being<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// stepped over one char, assumed to be a comma.<br><br>SearchBlocks</span><span class="tab" val="63"></span><span style="font: 10pt serif">// SearchBlocks(S,MemX,AVec,Addr) searches all symbol blocks<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// for the address symbol in MemX whose value is the largest<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// le AVec.  Optional fourth arg Addr causes ".-3" to ".+3"<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// to be printed if no symbol exactly equals AVec and if<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// AVec!1 is within 3 of Addr.  Otherwise, the symbol is<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// printed on the stream S followed by the displacement "+n".<br><br>UpdateRcd</span><span class="tab" val="63"></span><span style="font: 10pt serif">// UpdateRcd(Key, Body, BodySize)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// either inserts a new or updates an existing record.<br><br>SaveRcdFile</span><span class="tab" val="63"></span><span style="font: 10pt serif">// SaveRcdFile(Stream,Block,Npages) writes out dirty<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// symbol blocks on Midas.SymTab.<br><br>RestoreRcdFile</span><span class="tab" val="63"></span><span style="font: 10pt serif">// RestoreRcdFile(Stream,Block,Npages) restores it<br><br>FindInTable</span><span class="tab" val="63"></span><span style="font: 10pt serif">// FindInTable(Key, Body, lv BodySize) attempts<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// to find a table entry.  Returns true if succeeded.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Key is a pointer to a bcpl string.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Body is place where result record will be placed.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// BodySize will contain actualsize of body.<br><br>TVtoString</span><span class="tab" val="63"></span><span style="font: 10pt serif">// TVtoString(TV) returns a sstring with same contents <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// as the textvec TV.  Only one such string may exist<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// at a time. (They are stored in a fixed vector)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// useful for making entries in symbol table.<br><br><br><br>//MTXTBUF<br><br>ClearInText</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ClearInText() flags input text buffer to go to empty<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// if any new chars are typed.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"><br>TxtBNewChar</span><span class="tab" val="63"></span><span style="font: 10pt serif">// TxtBNewChar(Char) puts Char into the command line input<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// buffer<br><br><br>//MMENU<br><br>CreateAction</span><span class="tab" val="63"></span><span style="font: 10pt serif">// CreateAction(Name, lv Proc, Arg, lv MCProc, Char)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// creates an action for use in a menu item.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// (See above for Marks, in description of .)  Name is a<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// text name for the action.  Proc is a procedure.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// (lv is used so if the contents of the static changes,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// e.g. during swapout, the action will use the changed value<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// of the static.)  Arg will be supplied as Arg2 in the call to<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Proc.  (again, see above description.)  Storage is<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// obtained from a resident table and the name string<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is not copied, so it must be resident also. If lv MCProc<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is given and non zero, that procedure will be<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// called each time the mouse buttons change and this action<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is in the selected menu item.  Char is a character which<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// invokes the action from the keyboard when ";" precedes<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// it (and "=" and ":" not preceded by ";"<br><br>ForgetTemporaryActions</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Deletes actions created during command overlay.<br><br>DoTextAction</span><span class="tab" val="63"></span><span style="font: 10pt serif">// DoTextAction(String) exectutes the action named String<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// in the "CMD" menu<br><br>ExecuteTextCmdStream<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// ExecuteTextCmdStream(Stream) is used by Cmd to </span><span class="tab" val="63"></span><span style="font: 10pt serif"><br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// read commands from a text <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// stream, of the form created by the write cmd<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// stream action.<br><br>MarkMenus</span><span class="tab" val="63"></span><span style="font: 10pt serif">// MarkMenus(Proc) is called to mark the last text output<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// to ItemStream as a menu item such that Proc gets<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// called when that text is bugged.  Marks as a null<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// menu item if Proc is 0.<br><br>FormMenu</span><span class="tab" val="63"></span><span style="font: 10pt serif">// FormMenu(MDFS,Proc,Arg) rebuilds a menu by initializing<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// and then calling Proc(ItemStream,Arg).<br><br><br>//MMPRGN<br><br>InitMPDispRegions</span><span class="tab" val="63"></span><span style="font: 10pt serif">// InitMPDispRegions() define the address and value<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// actions for the register area of the display.<br><br>MPDSwitchPhase</span><span class="tab" val="63"></span><span style="font: 10pt serif">// MPDSwitchPhase() must be called whenever the register<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// display has changed, so that it gets updated<br><br>DoubleNeg</span><span class="tab" val="63"></span><span style="font: 10pt serif">// DoubleNeg(N) negates the double-precision integer<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// pointed to by N<br><br>ShowBadAddr</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ShowBadAddr([Str]) prints "Bad address" on<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// CmdCommentStream if arg omitted else Str.<br><br>ShowAddr</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ShowAddr(AVal) gives the alternate printout of an<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// address or register on the command comment line.  This<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is both memory and offset and symbol and offset for<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// addresses or is register and offset for registers.<br><br><br>//MCMD<br><br>InitCmd</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// InitCmd(Father, rlx, rcx, H, W) initializes the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// command menu region.<br><br>WssCSS</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// WssCSS(str) prints string on command comment line.<br><br>WsMarkA</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// WsMarkA(Action) puts up the name of Action in the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// command menu followed by a blank.<br><br>ConfirmAct</span><span class="tab" val="63"></span><span style="font: 10pt serif">// ConfirmAct(Str,TV) temporarily turns on display (if off)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// and prints on the command comment line first Str, then TV,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// and finally "[Confirm]".  Returns false if not confirmed<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// else true if confirmed, display restored to original state.<br><br>DisplayError</span><span class="tab" val="63"></span><span style="font: 10pt serif">// DisplayError(S1, S2) should only be called<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// by routines running in response to a MouseButton<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// going to zero, and only after at least one previous<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// call to SetCmdAbortLabel.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// S1 is a string explaining the error.  S2 is an<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// optional string which will be a selectable item<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// to allow continuation.  The only other selectable<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// item aborts.<br><br>QuickOpenFile</span><span class="tab" val="63"></span><span style="font: 10pt serif">// QuickOpenFile(Name,ksType,Item) first searches table<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// of fp&rsquo;s for Name.  If found, opens file quickly with fp,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// else opens with OpenFile.<br><br>StartCmdOverlay<br><br>QuitCmdOverlay</span><span class="tab" val="63"></span><span style="font: 10pt serif">// QuitCmdOverlay() is called by an overlay which<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// has been called by a cmd menu item using <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// StartCmdOverlay.<br><br>CmdAbort</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Routine used to abort command overlays invoked by<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// control-C.<br><br>FormCmdmenuText</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Procedure arg for FormMenu when a command overlay<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is rebuilding command menu.<br><br><br>//MOSUTILS<br><br>Wss,Wns,Wos</span><span class="tab" val="63"></span><span style="font: 10pt serif">// These routines defined--stripped version of OSUTILS.<br><br><br>//MX</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Resident hardware interface procedures<br><br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Procedures below accept arguments of the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// following types:<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">DVec</span><span class="tab" val="63"></span><span style="font: 10pt serif">Microprocessor data, multi word,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">packed left justified, as in Micro<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">format.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">AVec</span><span class="tab" val="63"></span><span style="font: 10pt serif">a double precision memory address vector<br><br>PutMemData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// PutMemData(MemX,AVec,DVec) stores DVec in <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// memory MemX address AVec<br><br>MPutMemData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// PutMemData(...), dirty display, and restore incidentally<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// clobbered registers.<br><br>GetMemData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// GetMemData(MemX,AVec,DVec) fetches data from AVec in<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// MemX, stores the result in DVec<br><br>MGetMemData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// GetMemData(...) and restore incidentally clobbered<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// registers.<br><br>PutRegData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// PutRegData(RegX,DVec) stores DVec into register RegX<br><br>MPutRegData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// PutRegData(...), dirty display, and restore incidentally<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// clobbered registers.<br><br>GetRegData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// GetRegData(RegX,DVec) fetches register RegX into DVec<br><br>MGetRegData</span><span class="tab" val="63"></span><span style="font: 10pt serif">// GetRegData(...), restore incidentally clobbered<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// registers, and dirty display.<br><br>ReadAllRegs()</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Reads and saves much of machine state.  Called after<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// changing registers and after halting.<br><br>RestoreAfterLoad()</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Restores registers clobbered incidentally during<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// loading of memories from .MB files by PutMemData.<br><br>InsertBreak(Addr)</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Inserts breakpoint at IM address Addr<br><br>RemoveBreak(Addr)</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Removes breakpoint at IM address Addr (at IMA<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// if no argument)<br><br>SingleStepM(Addr)</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Single-step microprocessor at Addr (at IMA-NPC<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// if no argument passed).<br><br>StartM(Addr)</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Start microprocessor at IMA = Addr, NPC = Addr+1 (at<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// current IMA-NPC if no argument passed).  Returns a<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// command menu procedure.<br><br>ProcOnTest()</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Returns true if hardware cannot be loaded (e.g., power<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// off) else true--called from mload.bcpl<br><br>InitHardware()</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Initialize hardware after other Midas initialization<br><br>FinishHardware()</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Routine called before Midas exit to OS.<br><br><br>//MINIT0</span><span class="tab" val="63"></span><span style="font: 10pt serif">PostJunta first init.  Includes MINIT0, MDI, OVERLAYSINIT,<br>//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">MXI0, LOADRAM, MAXCALTOCODE23<br>//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Flushed after execution.<br><br>Init0</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Rebuilds sysZone, loads special Alto microcode,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// initializes allocator, checks auxiliary<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Midas files creating or giving errors for ones that don&rsquo;t<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// exist.  If Midas/I does full init, else RestoreState.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Code for Init0 is flushed later in init.<br><br><br>//MINIT1</span><span class="tab" val="63"></span><span style="font: 10pt serif">PostJunta second init (only called on Midas/I)<br><br>Init1</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Continues initialization begun by Init0.<br><br>NewRegion</span><span class="tab" val="63"></span><span style="font: 10pt serif">// NewRegion(blocksize, father, rlx, rcx, Height, Width,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">pPaint, PSelect, PMchange, PdeSelect)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// returns a new region, with the basic regions<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// parameters initialized.  its father will be as<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// specified, and the new region will be spliced at the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// end of the brother chain of sons.  blocksize is for<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// the total region including the basic region.  Space is<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// obtained using GetStorage.<br><br>MakeMenuRegion</span><span class="tab" val="63"></span><span style="font: 10pt serif">// MakeMenuRegion(Letter,LineN, rlx, rcx, H, W, MaxH, MaxW, <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">MaxNItems, Arg, PdeSelect)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// creates a menu region, where:<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">Letter = letter part of menu name for comfiles<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">LineN = line number part of menu name for comfiles<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">rlx, rcx, H, W  give initial shape to the region<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">MaxH, MaxW</span><span class="tab" val="63"></span><span style="font: 10pt serif">limits max future values<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">MaxNItems</span><span class="tab" val="63"></span><span style="font: 10pt serif">maximum num menu items<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif"><br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">PFormText should be proceded by:<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Resets(S, Father, rlx, rcx, H, W)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Wss(S, ...); Marks(S, Act1)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Wss(S, text2); Marks(S, Act2)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">etc.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">where Texti is the text of item i<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">and Acti is the result of a previous<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">call to CreateAction.  The procedure<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">named in Acti will be called if itemi is<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">"bugged".  rlx, rcx, H, W should be new <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">values for these properties of the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">menu region, or old values.<br><br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">If P1 is the procedure in Acti, then<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Pi will be called (when bugged) as<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">  Pi(S, Argi, MBUnion, Arg2)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">where<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">S is the stream of the menu<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Arg1 is the original argument<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">   in the call that created <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">    the menu.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Arg2 is the arg in the call<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">   which created Acti.<br><br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Acti = 0 is allowed, and the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">item will never be selected.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">Wss can be any thing that <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">results in a series of Puts calls.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">PSelect(S, Arg) will be called when the menu<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">region is selected.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">PdeSelect(S, Arg) will be called when the menu<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">region is deselected.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">these last two routines may call Reset(S)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">to restructure the menu. In this case, <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">PFormText will be called.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Space is obtained using GetStorage, using Zone as a<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// parameter. If zone not supplied, then 0 is used in<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// call to GetStorage.<br><br>DefineMemory</span><span class="tab" val="63"></span><span style="font: 10pt serif">// DefineMemory(String,MemX,BitWidth,Hsize,Size)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// defines a memory.  String is the bcpl string name of<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// the memory.  MemX is the internal memory number,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// used in the hardware interface to the microprocessor.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// BitWidth is the width of a single word in bits. Size <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is  the number of words (of size BitWidth) in the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// memory.  Hsize is the high part of Size (0 unless<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// more than 64K words in memory).<br><br>DefineRegister</span><span class="tab" val="63"></span><span style="font: 10pt serif">// DefineRegister(String,RegX,BitWidth)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// defines a register.  String is the bcpl string name<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// of the register.  RegX is the internal register<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// number, used in the hardware interface to the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// microprocessor.  BitWidth is the number of bits<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// in the register.<br><br>NewMPDispBlock</span><span class="tab" val="63"></span><span style="font: 10pt serif">// NewMPDispBlock(L,C,Cnm,W) must be called to initialize<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// each register display block (see InitMPInterface later)<br><br>//MXI<br><br>InitMPInterface</span><span class="tab" val="63"></span><span style="font: 10pt serif">// InitMPInterface(), called by Init1,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// is expected to perform following calls:<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// for each register to be defined:<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">DefineRegister(StringName,RegX,BitWidth)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// for each Memory to be defined:<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">DefineMemory(StringName,MemX,BitWidth,Hsize,Size)<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// for each display block to be placed on the screen:<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//</span><span class="tab" val="63"></span><span style="font: 10pt serif">NewMPDispBlock(L, C, Cnm, W)<br><br><br>//***OVERLAYS BEGIN HERE***<br><br><br>//*INIT2* overlay<br><br>//MINIT2</span><span class="tab" val="63"></span><span style="font: 10pt serif">PostJunta second init loaded into the normal overlay zone<br>//</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">constructed from the display bit buffers.<br><br>Init2</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Init2() completes Midas initialization.<br><br><br>//*INIT3* overlay<br><br>//MINIT3<br><br>Init3</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Does final display and region initialization, then<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// parses Com.CM in preparation for doing a Read-Cmds.<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// It returns true if Read-Cmds should be done.<br><br><br>//*LOADER overlay*<br><br><br>//MLOAD<br><br>InitLoad</span><span class="tab" val="63"></span><span style="font: 10pt serif">// InitLoad(lvProc) brings in loader overlay and<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// invokes lvProc (= LoadMB, LoadSyms, DumpMB, or<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// MBCompare) after initialization.<br><br>LoadMB</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Loads files specified by input text<br><br>LoadSyms</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Loads symbols only<br><br>DumpMB</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Dumps microprocessor state on .MB file specified<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// by input text under control of .MB files used for<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// previous MBLoad or MBSyms.<br><br>MBCompare</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Compares microprocessor state against .MB file<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// where .MB file must have been created by MBDump<br><br><br>//*MICTST overlay* not documented here<br><br>//*POWER overlay*<br><br>MicGo</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// MicGo() called from Cmd for power on<br><br>MicStop</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// MicStop() called from Cmd for power off<br><br>//   external statics of Midas<br><br>//MIDAS<br><br>InitializingZone // non-zero during Init1 only--the zone where the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// Init1 overlay is put.<br><br><br>// MASM<br><br>AbortLabel</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Statics used by ErrorProtect and DisplayError<br>AbortFrame<br><br><br>//MDISP<br><br>@NewMB</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//Mouse buttons left by GetMouseAndCursor<br>@NewLx</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//Cursor line index<br>@NewCx</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">//Cursor character index<br><br>VertIntFlag</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Referenced in MASM<br>NwdsPerScanLine<br>FontP<br><br><br>//MRGN<br><br>ScreenTextLines</span><span class="tab" val="63"></span><span style="font: 10pt serif">// vector of textvecs for each line,<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// used by GetMouseAndCursor in mdisp<br><br>FinishFlag</span><span class="tab" val="63"></span><span style="font: 10pt serif">// any routine can force a finish at end of main loop<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// by setting this flag = true<br><br><br>//MTXTBUF<br><br>InputTextBuffer</span><span class="tab" val="63"></span><span style="font: 10pt serif">// a text vec containing typed in text<br>InputTxtRgn</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Display region for input text<br><br><br>//MOVERLAY<br><br>OverlayZone</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Zone from which overlay space was obtained, can<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// be used for space by the overlay code, so long as<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// all use terminated when overlay flushed<br><br>OverlayBusy</span><span class="tab" val="63"></span><span style="font: 10pt serif">// True if an overlay is loaded else false.<br><br><br>//MCMD<br><br>CmdCommentStream</span><span class="tab" val="63"></span><span style="font: 10pt serif">// a stream in which to write comments<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// for display on screen<br><br>TextCmdOutStream</span><span class="tab" val="63"></span><span style="font: 10pt serif">// if non zero, a stream on which menu should<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// write logical actions<br><br>ShowActionForm</span><span class="tab" val="63"></span><span style="font: 10pt serif">// if true, then menu should commment the <br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// current logical action<br><br>SavedLoadText</span><span class="tab" val="63"></span><span style="font: 10pt serif">// 73 word vector retaining file names of last load<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// for use by subsequent Dump<br><br>LoadDone</span><span class="tab" val="63"></span><span style="font: 10pt serif">// True to enable the "Dump" action (after a previous load)<br><br>ProgramStream</span><span class="tab" val="63"></span><span style="font: 10pt serif">// One text-line stream between the register display and<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// the command comment line on which the name of the<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// last program loaded is displayed.<br><br>CmdAltMenuP</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Non-zero if an alternate command menu is up (needed by<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// TxtBNewChar to check for whether or not type-ahead is<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// legal.<br><br><br>//MINIT0<br><br>MidasFP</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// FP for Midas.run (Needed by overlay package)<br>BlockStoreFP</span><span class="tab" val="63"></span><span style="font: 10pt serif">// FP for Midas.SymTab (Alphabetically sorted symbol table)<br>MidasRFP</span><span class="tab" val="63"></span><span style="font: 10pt serif">// FP for Midas.Resume (state of Midas after init)<br>mdsInitFP</span><span class="tab" val="63"></span><span style="font: 10pt serif">// FP for Midas.Midas<br>AltIOFP</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// FP for AltIO.run<br>FixUpFP</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// FP for Midas.Fixups (temporary file during loading)<br>ErrsFP</span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// FP for Midas.Errors (output of Compare action)<br><br><br>//MINIT1<br><br>ScreenHeight</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Number of lines in display (Due to bug it is two<br></span><span class="tab" val="63"></span><span class="tab" val="63"></span><span style="font: 10pt serif">// lines greater than that at present.)<br><br>ScreenWidth</span><span class="tab" val="63"></span><span style="font: 10pt serif">// Number of characters per screen line<br></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
