<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[Indigo]&lt;Maxc>MaxcOperations0-20Bravo.Dm!5>MaxcOps14.Bravo</title>
  </head>
  <body>
    <div style="width: 405pt; margin-left: 121pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">Page Numbers: Yes   X: 527   Y: 10.5" First Page: 50<br>Columns: 1   Edge Margin: .4"   Between Columns: .4"<br>Margins:   Top: 1.3"   Bottom: 1"<br>Line Numbers: No   Modulus: 5   Page-relative<br>Odd Heading:</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Maxc Operations</span><span class="tab" val="24"></span><span style="font: bold italic 10pt serif">Recovery from Checkdsk Errors</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt serif">Even Heading:</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="tab" val="24"></span><span style="font: bold italic 10pt serif">Recovery from Checkdsk Errors</span><span class="tab" val="24"></span><span style="font: bold 12pt serif">Maxc Operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: center">
<span style="font: bold 10pt serif">14.  RECOVERY FROM CHECKDSK ERRORS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">As explained in Section 6, when Tenex is restarted, whether initially or due to an auto-restart after a crash, the programs Bsys and Checkdsk are run to verify the consistency of the file system.  If either of these programs detects errors which cannot be corrected automatically, the message "Tenex not available: Disk needs fixing" is broadcast to all terminals instead of the usual "Tenex in operation" message, and logins are prohibited from all terminals except the two in the Maxc room.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">The following procedures require wheel or operator status and are intended principally for reference by system personnel.  With some assistance from a user in the Maxc room, a system maintainer can perform these procedures from a home terminal.  Only in extreme circumstances should non-system personnel attempt any of these procedures.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">Errors detected by Bsys (which are usually reflected by some further errors detected by Checkdsk) indicate inconsistencies in the structure of user file directories.  Fixing these requires a fairly intimate knowledge of the Tenex directory structure;  this should be left to system personnel.  Information about the structure of directories may be found in the Tenex Monitor Manual, section VII, pages 2-5.  Other helpful information is available in the Bsys manual, pages 33-36.  Copies of both these documents are kept in the Maxc room book case.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">Checkdsk errors come in a number of guises.  For each file with errors, data will be printed as in the following example:</span><span class="tab" val="24"></span><span style="font: italic 8pt serif">(NOTE: Before looking at CheckDsk errors you may have to do a "Diablo Copy ON" in the<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 8pt serif"> upper AltIO window to get hard copy output of the error messages; then Boot Micro-Exec,<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 8pt serif"> Start Tenex.)</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt serif">&lt;NEELY&gt;MESSAGE.COPY;3</span><span class="tab" val="24"></span><span style="font: 10pt serif">Filename<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">40050172166 MDA 0</span><span class="tab" val="24"></span><span style="font: 10pt serif">} List of errors<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">140050172170 MDA 63</span><span class="tab" val="24"></span><span style="font: 10pt serif">}<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">1 PTE</span><span class="tab" val="24"></span><span style="font: 10pt serif">} Error<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">2 MDA</span><span class="tab" val="24"></span><span style="font: 10pt serif">} summary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">If there are many errors in a single file, Checkdsk will print out only the first few, followed by the summary.  Study the output carefully.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">First, note that "NOT IN BT" errors </span><span style="font: italic 10pt serif">have been corrected by Checkdsk,</span><span style="font: 10pt serif"> so don&rsquo;t worry about them.  If these were the only errors that occurred, Checkdsk wouldn&rsquo;t have complained and the system would have flown on.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span style="font: 10pt serif">The other kinds of errors reported by Checkdsk are more serious:</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt serif">MDA</span><span class="tab" val="24"></span><span style="font: 10pt serif">Multiply-assigned disk address<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">IDA</span><span class="tab" val="24"></span><span style="font: 10pt serif">Illegal disk address<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">PTE</span><span class="tab" val="24"></span><span style="font: 10pt serif">Page table error</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">MDA errors are the only ones that cause Tenex to prohibit users from logging in, since further file activity is likely to make the damage spread.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">Note that you will have to use some </span><span style="font: italic 10pt serif">judgment</span><span style="font: 10pt serif"> in discriminating between garbaged page tables<br>and real MDA errors.  A file with a garbaged page table will have an enormous error count (in the hundreds) with many categories of errors (IDA, MDA, PTE, etc).  This is frequently caused by an untimely Tenex crash occurring between directory update and page table update during new file creation, so that the page table for the file will not have been written on the disk yet and whatever was on that page before will be interpreted as a page table. This type of error may result in many </span><span style="font: italic 10pt serif">other</span><span style="font: 10pt serif"> files getting bogus MDA errors because some of the entries in the garbaged page table look like valid disk addresses that happen already to be assigned.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">For further confirmation that the problem is a garbaged (unwritten) page table, a QFD of the filename should reveal that it was created within a minute or two before the time of the last system crash.  Such a file should be deleted using the following procedure:</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt serif">@</span><span style="font: 10pt serif; text-decoration: underline">ENABLE password &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">CONNECT &lt;directory with bad file&gt; &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">DELETE &lt;bad filename&gt; &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">EXPUNGE &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">This procedure causes the bad file to be expunged from the directory.  A number of valid addresses possibly in use by other files may be deallocated, but don&rsquo;t worry about this.  The system will generate a number of BUGCHKs for illegal disk addresses, but don&rsquo;t worry about this either.  (Be sure DCHKSW is set to zero, however, to prevent the system from breakpointing on these errors).  Run Checkdsk again after performing this surgery to make sure you did it right and that there is nothing else wrong.  Checkdsk will reallocate pages incorrectly deallocated by the preceding procedure and will type out "NOT IN BT" for these.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">CONNECT SYSTEM &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">CHECKDSK &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">REBUILD BIT TABLE? </span><span style="font: 10pt serif; text-decoration: underline">N</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">SCAN FOR DISK ADDRESSES? </span><span style="font: 10pt serif; text-decoration: underline">N</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span style="font: 10pt serif">(This currently takes about 15 minutes).</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">After all files with garbaged page tables have been eliminated (if there were any), any further errors are considerably more serious, particularly MDA errors.  MDA stands for multiply-allocated disk address, meaning that a particular page has somehow been assigned to more than one file.  For each such error, Checkdsk has printed out the </span><span style="font: italic 10pt serif">second</span><span style="font: 10pt serif"> file owning the page that it encountered in its scan of the file system;  you do not yet know the name of the other owner of that page.  Hence you should follow this procedure:</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">CONNECT &lt;directory containing file with MDA error&gt; &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">COPY &lt;affected filename&gt; GARBAGE &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">DELETE &lt;affected filename&gt; &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">EXPUNGE &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">RENAME GARBAGE &lt;affected filename&gt; &lt;cr&gt;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">Repeat this procedure for all affected files.  You should be careful to type the &lt;affected filename&gt; in full, including version number, so you don&rsquo;t mistakenly fix up the wrong file.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">Next, re-run Checkdsk as explained above.  While running, Checkdsk will type out a number of NOT IN BT errors whose disk addresses correspond to the disk addresses in the original MDA error printouts;  the filenames typed out will be those of the </span><span style="font: italic 10pt serif">other owners</span><span style="font: 10pt serif"> of the pages that were multiply assigned.  It may not be obvious which owner of a page has the correct copy (a QFD of the filenames will include the write dates, which may give some indication; i.e. the file with the newer write date is more likely to have the correct data), but you have done the best that can be done by giving non-conflicting copies to everybody involved.  Use SNDMSG to notify all users who have (potentially) lost files.  Both the original MDA and the final NOT IN BT files are involved in the loss.</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">When you have pieced the filesystem back together to what you believe is a reasonable state, you should open the system to users by the following procedure:</span><span class="tab" val="24"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">QUIT &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">.</span><span style="font: 10pt serif; text-decoration: underline">/</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif; text-decoration: underline">FACTSW[</span><span style="font: 10pt serif"> 500000,,0   </span><span style="font: 10pt serif; text-decoration: underline">400000,,0 &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif; text-decoration: underline">&lt;control-P&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">ABORT<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">.</span><span style="font: 10pt serif; text-decoration: underline">&uarr;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">!</span><span style="font: 10pt serif; text-decoration: underline">LOGOUT &lt;cr&gt;</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: 10pt serif">LOGOUT JOB ......<br></span><span class="tab" val="24"></span><span style="font: 10pt serif; text-decoration: underline">&lt;control-C&gt;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: justify">
<span style="font: 10pt serif">After you type control-C, the auto-jobs should start logging in, and shortly thereafter "Tenex in operation" will be broadcast.</span><span class="tab" val="24"></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
